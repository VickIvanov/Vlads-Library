<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ - –ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 20px;
            position: relative;
            color: #333;
        }
        
        .header {
            max-width: 1200px;
            margin: 0 auto 30px;
            background: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            color: #333;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: clamp(12px, 2vw, 18px) clamp(40px, 6vw, 55px) clamp(12px, 2vw, 18px) clamp(18px, 2.5vw, 22px);
            border: 2px solid #ddd;
            border-radius: clamp(20px, 3vw, 30px);
            font-size: clamp(14px, 1.8vw, 18px);
            outline: none;
            transition: border-color 0.3s;
        }
        
        @media (max-width: 768px) {
            .search-input {
                padding: 12px 40px 12px 18px;
                font-size: 16px; /* –ë–æ–ª—å—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
        }
        
        .search-input:focus {
            border-color: #007bff;
        }
        
        .search-history {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: none;
            margin-top: 5px;
        }
        
        .search-history-item {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        
        .search-history-item:hover {
            background: #f5f5f5;
        }
        
        .search-history-item:last-child {
            border-bottom: none;
        }
        
        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: clamp(8px, 1.2vw, 12px) clamp(12px, 2vw, 18px);
            border: 2px solid #ddd;
            border-radius: clamp(4px, 0.6vw, 6px);
            font-size: clamp(12px, 1.5vw, 16px);
            outline: none;
            cursor: pointer;
            background: white;
            min-width: clamp(120px, 18vw, 180px);
            transition: all 0.3s ease;
        }
        
        .filter-select:focus {
            border-color: #007bff;
            transform: scale(1.02);
        }
        
        .clear-filters {
            padding: clamp(8px, 1.2vw, 12px) clamp(16px, 2.5vw, 24px);
            background: #dc3545;
            color: white;
            border: none;
            border-radius: clamp(4px, 0.6vw, 6px);
            cursor: pointer;
            font-size: clamp(12px, 1.5vw, 16px);
            transition: all 0.3s ease;
            min-height: clamp(36px, 5vw, 44px);
        }
        
        .clear-filters:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .filter-select, .clear-filters {
                width: 100%;
                min-width: 100%;
                padding: 10px;
                font-size: 14px;
            }
        }
        
        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #666;
        }
        
        .admin-link {
            text-align: center;
            margin-top: 15px;
        }
        
        .admin-link a {
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
        }
        
        .admin-link a:hover {
            text-decoration: underline;
        }
        
        .books-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            color: #333;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(clamp(200px, 25vw, 300px), 1fr));
            gap: clamp(15px, 2vw, 25px);
            margin-top: clamp(15px, 2vh, 25px);
        }
        
        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        @media (min-width: 1200px) {
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        .book-card {
            border: 1px solid #ddd;
            padding: clamp(15px, 2vw, 25px);
            border-radius: clamp(8px, 1.2vw, 12px);
            background: white;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            color: #333;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .book-card h3 {
            margin-bottom: clamp(8px, 1.2vw, 12px);
            color: #333;
            font-size: clamp(16px, 2vw, 20px);
        }
        
        .book-card .author {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .book-card .genre {
            display: inline-block;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: #555;
            margin-top: 10px;
        }
        
        .book-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .book-card .description {
            color: #888;
            font-size: 13px;
            margin-top: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .no-books {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .stats {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é */
        .menu-toggle {
            position: fixed;
            top: clamp(10px, 2vh, 20px);
            right: clamp(10px, 2vw, 20px);
            padding: clamp(10px, 1.5vw, 14px) clamp(16px, 2.5vw, 24px);
            background: rgba(0, 123, 255, 0.9);
            color: white;
            border: none;
            border-radius: clamp(4px, 0.6vw, 6px);
            cursor: pointer;
            font-size: clamp(18px, 2.5vw, 24px);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            min-width: clamp(50px, 8vw, 60px);
            min-height: clamp(50px, 8vw, 60px);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .menu-toggle:hover {
            background: rgba(0, 86, 179, 0.95);
            transform: scale(1.1);
        }
        
        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: clamp(300px, 40vw, 350px);
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            z-index: 2000;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: clamp(20px, 3vw, 30px);
        }
        
        .sidebar.active {
            right: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(20px, 3vh, 30px);
            padding-bottom: clamp(15px, 2vh, 20px);
            border-bottom: 2px solid #e0e0e0;
        }
        
        .sidebar-header h2 {
            color: #333;
            margin: 0;
            font-size: clamp(20px, 3vw, 24px);
        }
        
        .close-sidebar {
            background: none;
            border: none;
            font-size: clamp(24px, 4vw, 32px);
            color: #666;
            cursor: pointer;
            padding: 0;
            width: clamp(30px, 5vw, 40px);
            height: clamp(30px, 5vw, 40px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-sidebar:hover {
            color: #333;
            transform: rotate(90deg);
        }
        
        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: clamp(10px, 1.5vh, 15px);
        }
        
        .sidebar-menu .btn {
            width: 100%;
            text-align: left;
            padding: clamp(12px, 2vh, 16px) clamp(16px, 2.5vw, 20px);
            font-size: clamp(14px, 2vw, 16px);
            justify-content: flex-start;
            display: flex;
            align-items: center;
            gap: clamp(10px, 1.5vw, 15px);
            background: #007bff;
            color: white;
            border: none;
            border-radius: clamp(4px, 0.6vw, 6px);
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .sidebar-menu .btn:hover {
            background: #0056b3;
            transform: scale(1.02);
        }
        
        .sidebar-menu .btn-secondary {
            background: #6c757d;
        }
        
        .sidebar-menu .btn-secondary:hover {
            background: #545b62;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 85vw;
                right: -85vw;
            }
            
            .menu-toggle {
                padding: 12px;
                min-width: 50px;
                min-height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body id="body">
    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
    <button class="menu-toggle" onclick="toggleSidebar()" title="–ú–µ–Ω—é">
        ‚ò∞
    </button>
    
    <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>–ú–µ–Ω—é</h2>
            <button class="close-sidebar" onclick="closeSidebar()" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div class="sidebar-menu">
            <a href="/" class="btn btn-secondary" onclick="closeSidebar();">
                üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            </a>
            <a href="/admin" class="btn btn-secondary" onclick="closeSidebar();">
                üë§ –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            </a>
        </div>
    </div>
    
    <div class="header">
        <h1>üìö –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
        <div class="search-container">
            <input 
                type="text" 
                class="search-input" 
                id="searchInput" 
                placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É, –∂–∞–Ω—Ä—É –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..."
                onkeyup="handleSearchInput()"
                onfocus="showSearchHistory()"
                onblur="setTimeout(() => hideSearchHistory(), 200)"
                autocomplete="off"
            >
            <span class="search-icon">üîç</span>
            <div class="search-history" id="searchHistory"></div>
        </div>
        
        <div class="filters-container">
            <select id="filterAuthor" class="filter-select" onchange="applyFilters()">
                <option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>
            </select>
            <select id="filterGenre" class="filter-select" onchange="applyFilters()">
                <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                <optgroup label="–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">
                    <option value="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</option>
                    <option value="–§—ç–Ω—Ç–µ–∑–∏">–§—ç–Ω—Ç–µ–∑–∏</option>
                    <option value="–î–µ—Ç–µ–∫—Ç–∏–≤">–î–µ—Ç–µ–∫—Ç–∏–≤</option>
                    <option value="–¢—Ä–∏–ª–ª–µ—Ä">–¢—Ä–∏–ª–ª–µ—Ä</option>
                    <option value="–£–∂–∞—Å—ã">–£–∂–∞—Å—ã</option>
                    <option value="–†–æ–º–∞–Ω">–†–æ–º–∞–Ω</option>
                    <option value="–õ—é–±–æ–≤–Ω—ã–π —Ä–æ–º–∞–Ω">–õ—é–±–æ–≤–Ω—ã–π —Ä–æ–º–∞–Ω</option>
                    <option value="–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</option>
                    <option value="–ë–æ–µ–≤–∏–∫">–ë–æ–µ–≤–∏–∫</option>
                    <option value="–ú–∏—Å—Ç–∏–∫–∞">–ú–∏—Å—Ç–∏–∫–∞</option>
                    <option value="–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Ç–∏–∫–∞">–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Ç–∏–∫–∞</option>
                    <option value="–î—Ä–∞–º–∞">–î—Ä–∞–º–∞</option>
                    <option value="–ö–æ–º–µ–¥–∏—è">–ö–æ–º–µ–¥–∏—è</option>
                    <option value="–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω</option>
                </optgroup>
                <optgroup label="–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏ —Å–µ—Ä–∏–∏">
                    <option value="–°–∏–∫–≤–µ–ª">–°–∏–∫–≤–µ–ª</option>
                    <option value="–ü—Ä–∏–∫–≤–µ–ª">–ü—Ä–∏–∫–≤–µ–ª</option>
                    <option value="–°–ø–∏–Ω-–æ—Ñ—Ñ">–°–ø–∏–Ω-–æ—Ñ—Ñ</option>
                    <option value="–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–µ—Ä–∏–∏">–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–µ—Ä–∏–∏</option>
                    <option value="–ö–Ω–∏–≥–∞ —Å–µ—Ä–∏–∏">–ö–Ω–∏–≥–∞ —Å–µ—Ä–∏–∏</option>
                    <option value="–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å">–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å</option>
                    <option value="–¢—Ä–µ—Ç—å—è —á–∞—Å—Ç—å">–¢—Ä–µ—Ç—å—è —á–∞—Å—Ç—å</option>
                    <option value="–§–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å">–§–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å</option>
                </optgroup>
                <optgroup label="–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">
                    <option value="–ë–∏–æ–≥—Ä–∞—Ñ–∏—è">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</option>
                    <option value="–ú–µ–º—É–∞—Ä—ã">–ú–µ–º—É–∞—Ä—ã</option>
                    <option value="–ü–æ—ç–∑–∏—è">–ü–æ—ç–∑–∏—è</option>
                    <option value="–§–∏–ª–æ—Å–æ—Ñ–∏—è">–§–∏–ª–æ—Å–æ—Ñ–∏—è</option>
                    <option value="–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è</option>
                    <option value="–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ">–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ</option>
                    <option value="–ë–∏–∑–Ω–µ—Å">–ë–∏–∑–Ω–µ—Å</option>
                    <option value="–ù–∞—É–∫–∞">–ù–∞—É–∫–∞</option>
                    <option value="–¢–µ—Ö–Ω–∏–∫–∞">–¢–µ—Ö–Ω–∏–∫–∞</option>
                    <option value="–ú–µ–¥–∏—Ü–∏–Ω–∞">–ú–µ–¥–∏—Ü–∏–Ω–∞</option>
                    <option value="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                    <option value="–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</option>
                    <option value="–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è">–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è</option>
                    <option value="–ö—É–ª–∏–Ω–∞—Ä–∏—è">–ö—É–ª–∏–Ω–∞—Ä–∏—è</option>
                    <option value="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
                    <option value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option>
                    <option value="–•–æ–±–±–∏">–•–æ–±–±–∏</option>
                </optgroup>
                <optgroup label="–î–µ—Ç—Å–∫–∞—è –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">
                    <option value="–î–µ—Ç—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–î–µ—Ç—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–ú–∏—Ñ–æ–ª–æ–≥–∏—è">–ú–∏—Ñ–æ–ª–æ–≥–∏—è</option>
                    <option value="–§–æ–ª—å–∫–ª–æ—Ä">–§–æ–ª—å–∫–ª–æ—Ä</option>
                    <option value="–°–∫–∞–∑–∫–∏">–°–∫–∞–∑–∫–∏</option>
                    <option value="–ë–∞—Å–Ω–∏">–ë–∞—Å–Ω–∏</option>
                </optgroup>
                <optgroup label="–î—Ä—É–≥–æ–µ">
                    <option value="–†–µ–ª–∏–≥–∏—è">–†–µ–ª–∏–≥–∏—è</option>
                    <option value="–≠–∑–æ—Ç–µ—Ä–∏–∫–∞">–≠–∑–æ—Ç–µ—Ä–∏–∫–∞</option>
                    <option value="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                </optgroup>
            </select>
            <button class="clear-filters" onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </div>
        <div class="stats" id="stats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="books-container">
        <div class="books-grid" id="booksGrid">
            <div class="no-books">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥...</div>
        </div>
    </div>
    
    <script>
        let allBooks = [];
        let currentBackground = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ–Ω–∞
        async function loadSettings() {
            try {
                const res = await fetch('/api/settings');
                const data = await res.json();
                if (data.settings && data.settings.background) {
                    currentBackground = data.settings.background;
                    document.body.style.backgroundImage = `url(${currentBackground})`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥
        async function loadBooks(searchQuery = '') {
            try {
                const url = searchQuery 
                    ? `/api/books?search=${encodeURIComponent(searchQuery)}`
                    : '/api/books';
                    
                const res = await fetch(url);
                const books = await res.json();
                
                if (!searchQuery) {
                    allBooks = books;
                }
                
                displayBooks(books);
                updateStats(books.length, searchQuery);
                return Promise.resolve();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥:', error);
                document.getElementById('booksGrid').innerHTML = 
                    '<div class="no-books">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥</div>';
                return Promise.reject(error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–∏–≥
        function displayBooks(books) {
            const grid = document.getElementById('booksGrid');
            
            if (books.length === 0) {
                grid.innerHTML = '<div class="no-books">–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            grid.innerHTML = '';
            
            books.forEach(book => {
                const card = document.createElement('div');
                card.className = 'book-card';
                const bookId = String(book.id || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                const hasFile = book.book_file ? true : false;
                card.innerHTML = `
                    ${book.cover && book.cover.trim() !== '' ? `
                    <img src="${book.cover}" 
                         alt="${book.title}" 
                         onerror="this.onerror=null; this.style.display='none'; const placeholder=this.nextElementSibling; if(placeholder) placeholder.style.display='flex';" 
                         onload="const placeholder=this.nextElementSibling; if(placeholder) placeholder.style.display='none'; this.style.display='block';"
                         style="width: 100%; height: 200px; object-fit: cover; border-radius: 5px; margin-bottom: 15px; display: block;"
                         crossorigin="anonymous">
                    <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 5px; margin-bottom: 15px; display: none; align-items: center; justify-content: center; color: white; font-size: 48px;">üìö</div>
                    ` : '<div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 5px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">üìö</div>'}
                    <h3>${book.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
                    <div class="author"><b>–ê–≤—Ç–æ—Ä:</b> ${book.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}</div>
                    ${book.genre ? `<span class="genre">${book.genre}</span>` : ''}
                    ${book.description ? `<div class="description">${book.description}</div>` : ''}
                    ${hasFile ? `<button class="read-btn" onclick="downloadBook('${bookId}')" style="width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px;">üìñ –ß–∏—Ç–∞—Ç—å</button>` : ''}
                `;
                grid.appendChild(card);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(count, searchQuery) {
            const statsEl = document.getElementById('stats');
            if (searchQuery) {
                statsEl.textContent = `–ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: ${count}`;
            } else {
                statsEl.textContent = `–í—Å–µ–≥–æ –∫–Ω–∏–≥ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ: ${count}`;
            }
        }
        
        // –ü–æ–∏—Å–∫ –∫–Ω–∏–≥
        let searchTimeout;
        function searchBooks(query = null) {
            clearTimeout(searchTimeout);
            
            const searchInput = document.getElementById('searchInput');
            const searchQuery = query !== null ? query : searchInput.value.trim();
            
            if (searchQuery) {
                saveSearchHistory(searchQuery);
            }
            
            searchTimeout = setTimeout(() => {
                applyFilters();
            }, 300);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è/—á—Ç–µ–Ω–∏—è –∫–Ω–∏–≥–∏
        async function downloadBook(bookId) {
            try {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–µ–Ω–∏—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
                window.open(`/read?id=${encodeURIComponent(bookId)}`, '_blank');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–Ω–∏–≥–∏:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–Ω–∏–≥–∏');
            }
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const searchInput = document.getElementById('searchInput');
            const searchQuery = searchInput.value.trim().toLowerCase();
            const filterAuthor = document.getElementById('filterAuthor').value;
            const filterGenre = document.getElementById('filterGenre').value;
            
            let filtered = allBooks.filter(book => {
                const matchesSearch = !searchQuery || 
                    (book.title && book.title.toLowerCase().includes(searchQuery)) ||
                    (book.author && book.author.toLowerCase().includes(searchQuery)) ||
                    (book.genre && book.genre.toLowerCase().includes(searchQuery)) ||
                    (book.description && book.description.toLowerCase().includes(searchQuery));
                
                const matchesAuthor = !filterAuthor || (book.author === filterAuthor);
                const matchesGenre = !filterGenre || (book.genre === filterGenre);
                
                return matchesSearch && matchesAuthor && matchesGenre;
            });
            
            displayBooks(filtered);
            updateStats(filtered.length, searchQuery);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterAuthor').value = '';
            document.getElementById('filterGenre').value = '';
            applyFilters();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
        function handleSearchInput() {
            searchBooks();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
        function showSearchHistory() {
            const history = document.getElementById('searchHistory');
            const saved = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            if (saved.length > 0) {
                history.style.display = 'block';
            }
        }
        
        // –°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
        function hideSearchHistory() {
            document.getElementById('searchHistory').style.display = 'none';
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
        function saveSearchHistory(query) {
            if (!query) return;
            let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            history = history.filter(h => h !== query);
            history.unshift(query);
            history = history.slice(0, 10);
            localStorage.setItem('searchHistory', JSON.stringify(history));
            renderSearchHistory();
        }
        
        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
        function renderSearchHistory() {
            const history = document.getElementById('searchHistory');
            const saved = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            history.innerHTML = '';
            
            saved.forEach(query => {
                const item = document.createElement('div');
                item.className = 'search-history-item';
                item.textContent = query;
                item.onclick = () => {
                    document.getElementById('searchInput').value = query;
                    searchBooks(query);
                    hideSearchHistory();
                };
                history.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∞–≤—Ç–æ—Ä–æ–≤ –∏ –∂–∞–Ω—Ä–æ–≤
        function updateFilters() {
            const authors = [...new Set(allBooks.map(b => b.author).filter(Boolean))].sort();
            const genres = [...new Set(allBooks.map(b => b.genre).filter(Boolean))].sort();
            
            const authorSelect = document.getElementById('filterAuthor');
            const genreSelect = document.getElementById('filterGenre');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const currentAuthor = authorSelect.value;
            const currentGenre = genreSelect.value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤
            authorSelect.innerHTML = '<option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>';
            authors.forEach(author => {
                const option = document.createElement('option');
                option.value = author;
                option.textContent = author;
                if (author === currentAuthor) option.selected = true;
                authorSelect.appendChild(option);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑ –∫–Ω–∏–≥, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
            const genreOptions = genreSelect.querySelectorAll('option[value]');
            genreOptions.forEach(opt => {
                if (opt.value && !genres.includes(opt.value)) {
                    opt.style.display = 'none';
                } else if (opt.value) {
                    opt.style.display = 'block';
                }
            });
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫–æ–≤—ã–º –º–µ–Ω—é
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSidebar();
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            loadSettings();
            loadBooks().then(() => {
                updateFilters();
            });
            renderSearchHistory();
        };
    </script>
</body>
</html>


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ - –ö–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            min-height: 100vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 20px;
            position: relative;
            color: #333;
        }
        
        .header {
            max-width: 1200px;
            margin: 0 auto 30px;
            background: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            color: #333;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: clamp(12px, 2vw, 18px) clamp(40px, 6vw, 55px) clamp(12px, 2vw, 18px) clamp(18px, 2.5vw, 22px);
            border: 2px solid #ddd;
            border-radius: clamp(20px, 3vw, 30px);
            font-size: clamp(14px, 1.8vw, 18px);
            outline: none;
            transition: border-color 0.3s;
        }
        
        @media (max-width: 768px) {
            .search-input {
                padding: 12px 40px 12px 18px;
                font-size: 16px; /* –ë–æ–ª—å—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
        }
        
        .search-input:focus {
            border-color: #007bff;
        }
        
        .search-history {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: none;
            margin-top: 5px;
        }
        
        .search-history-item {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        
        .search-history-item:hover {
            background: #f5f5f5;
        }
        
        .search-history-item:last-child {
            border-bottom: none;
        }
        
        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: clamp(8px, 1.2vw, 12px) clamp(12px, 2vw, 18px);
            border: 2px solid #ddd;
            border-radius: clamp(4px, 0.6vw, 6px);
            font-size: clamp(12px, 1.5vw, 16px);
            outline: none;
            cursor: pointer;
            background: white;
            min-width: clamp(120px, 18vw, 180px);
            transition: all 0.3s ease;
        }
        
        .filter-select:focus {
            border-color: #007bff;
            transform: scale(1.02);
        }
        
        .clear-filters {
            padding: clamp(8px, 1.2vw, 12px) clamp(16px, 2.5vw, 24px);
            background: #dc3545;
            color: white;
            border: none;
            border-radius: clamp(4px, 0.6vw, 6px);
            cursor: pointer;
            font-size: clamp(12px, 1.5vw, 16px);
            transition: all 0.3s ease;
            min-height: clamp(36px, 5vw, 44px);
        }
        
        .clear-filters:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .filter-select, .clear-filters {
                width: 100%;
                min-width: 100%;
                padding: 10px;
                font-size: 14px;
            }
        }
        
        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #666;
        }
        
        .admin-link {
            text-align: center;
            margin-top: 15px;
        }
        
        .admin-link a {
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
        }
        
        .admin-link a:hover {
            text-decoration: underline;
        }
        
        .books-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            color: #333;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(clamp(200px, 25vw, 300px), 1fr));
            gap: clamp(15px, 2vw, 25px);
            margin-top: clamp(15px, 2vh, 25px);
        }
        
        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        @media (min-width: 1200px) {
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        .book-card {
            border: 1px solid #ddd;
            padding: clamp(15px, 2vw, 25px);
            border-radius: clamp(8px, 1.2vw, 12px);
            background: white;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            color: #333;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .book-card h3 {
            margin-bottom: clamp(8px, 1.2vw, 12px);
            color: #333;
            font-size: clamp(16px, 2vw, 20px);
        }
        
        .book-card .author {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .book-card .genre {
            display: inline-block;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: #555;
            margin-top: 10px;
        }
        
        .book-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .book-card .description {
            color: #888;
            font-size: 13px;
            margin-top: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .no-books {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .stats {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é */
        .menu-toggle {
            position: fixed;
            top: clamp(10px, 2vh, 20px);
            right: clamp(10px, 2vw, 20px);
            padding: clamp(10px, 1.5vw, 14px) clamp(16px, 2.5vw, 24px);
            background: rgba(0, 123, 255, 0.9);
            color: white;
            border: none;
            border-radius: clamp(4px, 0.6vw, 6px);
            cursor: pointer;
            font-size: clamp(18px, 2.5vw, 24px);
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            min-width: clamp(50px, 8vw, 60px);
            min-height: clamp(50px, 8vw, 60px);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .menu-toggle:hover {
            background: rgba(0, 86, 179, 0.95);
            transform: scale(1.1);
        }
        
        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: clamp(300px, 40vw, 350px);
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: -5px 0 20px rgba(0,0,0,0.3);
            z-index: 2000;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: clamp(20px, 3vw, 30px);
        }
        
        .sidebar.active {
            right: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(20px, 3vh, 30px);
            padding-bottom: clamp(15px, 2vh, 20px);
            border-bottom: 2px solid #e0e0e0;
        }
        
        .sidebar-header h2 {
            color: #333;
            margin: 0;
            font-size: clamp(20px, 3vw, 24px);
        }
        
        .close-sidebar {
            background: none;
            border: none;
            font-size: clamp(24px, 4vw, 32px);
            color: #666;
            cursor: pointer;
            padding: 0;
            width: clamp(30px, 5vw, 40px);
            height: clamp(30px, 5vw, 40px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-sidebar:hover {
            color: #333;
            transform: rotate(90deg);
        }
        
        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: clamp(10px, 1.5vh, 15px);
        }
        
        .sidebar-menu .btn {
            width: 100%;
            text-align: left;
            padding: clamp(12px, 2vh, 16px) clamp(16px, 2.5vw, 20px);
            font-size: clamp(14px, 2vw, 16px);
            justify-content: flex-start;
            display: flex;
            align-items: center;
            gap: clamp(10px, 1.5vw, 15px);
            background: #007bff;
            color: white;
            border: none;
            border-radius: clamp(4px, 0.6vw, 6px);
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .sidebar-menu .btn:hover {
            background: #0056b3;
            transform: scale(1.02);
        }
        
        .sidebar-menu .btn-secondary {
            background: #6c757d;
        }
        
        .sidebar-menu .btn-secondary:hover {
            background: #545b62;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 85vw;
                right: -85vw;
            }
            
            .menu-toggle {
                padding: 12px;
                min-width: 50px;
                min-height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body id="body">
    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é -->
    <button class="menu-toggle" onclick="toggleSidebar()" title="–ú–µ–Ω—é">
        ‚ò∞
    </button>
    
    <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>–ú–µ–Ω—é</h2>
            <button class="close-sidebar" onclick="closeSidebar()" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
        </div>
        <div class="sidebar-menu">
            <a href="/" class="btn btn-secondary" onclick="closeSidebar();">
                üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            </a>
            <a href="/admin" class="btn btn-secondary" onclick="closeSidebar();">
                üë§ –í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            </a>
        </div>
    </div>
    
    <div class="header">
        <h1>üìö –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
        <div class="search-container">
            <input 
                type="text" 
                class="search-input" 
                id="searchInput" 
                placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É, –∂–∞–Ω—Ä—É –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..."
                onkeyup="handleSearchInput()"
                onfocus="showSearchHistory()"
                onblur="setTimeout(() => hideSearchHistory(), 200)"
                autocomplete="off"
            >
            <span class="search-icon">üîç</span>
            <div class="search-history" id="searchHistory"></div>
        </div>
        
        <div class="filters-container">
            <select id="filterAuthor" class="filter-select" onchange="applyFilters()">
                <option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>
            </select>
            <select id="filterGenre" class="filter-select" onchange="applyFilters()">
                <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                <optgroup label="–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">
                    <option value="–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞">–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞</option>
                    <option value="–§—ç–Ω—Ç–µ–∑–∏">–§—ç–Ω—Ç–µ–∑–∏</option>
                    <option value="–î–µ—Ç–µ–∫—Ç–∏–≤">–î–µ—Ç–µ–∫—Ç–∏–≤</option>
                    <option value="–¢—Ä–∏–ª–ª–µ—Ä">–¢—Ä–∏–ª–ª–µ—Ä</option>
                    <option value="–£–∂–∞—Å—ã">–£–∂–∞—Å—ã</option>
                    <option value="–†–æ–º–∞–Ω">–†–æ–º–∞–Ω</option>
                    <option value="–õ—é–±–æ–≤–Ω—ã–π —Ä–æ–º–∞–Ω">–õ—é–±–æ–≤–Ω—ã–π —Ä–æ–º–∞–Ω</option>
                    <option value="–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</option>
                    <option value="–ë–æ–µ–≤–∏–∫">–ë–æ–µ–≤–∏–∫</option>
                    <option value="–ú–∏—Å—Ç–∏–∫–∞">–ú–∏—Å—Ç–∏–∫–∞</option>
                    <option value="–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Ç–∏–∫–∞">–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Ç–∏–∫–∞</option>
                    <option value="–î—Ä–∞–º–∞">–î—Ä–∞–º–∞</option>
                    <option value="–ö–æ–º–µ–¥–∏—è">–ö–æ–º–µ–¥–∏—è</option>
                    <option value="–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω</option>
                </optgroup>
                <optgroup label="–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏ —Å–µ—Ä–∏–∏">
                    <option value="–°–∏–∫–≤–µ–ª">–°–∏–∫–≤–µ–ª</option>
                    <option value="–ü—Ä–∏–∫–≤–µ–ª">–ü—Ä–∏–∫–≤–µ–ª</option>
                    <option value="–°–ø–∏–Ω-–æ—Ñ—Ñ">–°–ø–∏–Ω-–æ—Ñ—Ñ</option>
                    <option value="–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–µ—Ä–∏–∏">–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–µ—Ä–∏–∏</option>
                    <option value="–ö–Ω–∏–≥–∞ —Å–µ—Ä–∏–∏">–ö–Ω–∏–≥–∞ —Å–µ—Ä–∏–∏</option>
                    <option value="–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å">–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å</option>
                    <option value="–¢—Ä–µ—Ç—å—è —á–∞—Å—Ç—å">–¢—Ä–µ—Ç—å—è —á–∞—Å—Ç—å</option>
                    <option value="–§–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å">–§–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å</option>
                </optgroup>
                <optgroup label="–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">
                    <option value="–ë–∏–æ–≥—Ä–∞—Ñ–∏—è">–ë–∏–æ–≥—Ä–∞—Ñ–∏—è</option>
                    <option value="–ú–µ–º—É–∞—Ä—ã">–ú–µ–º—É–∞—Ä—ã</option>
                    <option value="–ü–æ—ç–∑–∏—è">–ü–æ—ç–∑–∏—è</option>
                    <option value="–§–∏–ª–æ—Å–æ—Ñ–∏—è">–§–∏–ª–æ—Å–æ—Ñ–∏—è</option>
                    <option value="–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è</option>
                    <option value="–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ">–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ</option>
                    <option value="–ë–∏–∑–Ω–µ—Å">–ë–∏–∑–Ω–µ—Å</option>
                    <option value="–ù–∞—É–∫–∞">–ù–∞—É–∫–∞</option>
                    <option value="–¢–µ—Ö–Ω–∏–∫–∞">–¢–µ—Ö–Ω–∏–∫–∞</option>
                    <option value="–ú–µ–¥–∏—Ü–∏–Ω–∞">–ú–µ–¥–∏—Ü–∏–Ω–∞</option>
                    <option value="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                    <option value="–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</option>
                    <option value="–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è">–≠–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è</option>
                    <option value="–ö—É–ª–∏–Ω–∞—Ä–∏—è">–ö—É–ª–∏–Ω–∞—Ä–∏—è</option>
                    <option value="–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</option>
                    <option value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option>
                    <option value="–•–æ–±–±–∏">–•–æ–±–±–∏</option>
                </optgroup>
                <optgroup label="–î–µ—Ç—Å–∫–∞—è –∏ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">
                    <option value="–î–µ—Ç—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–î–µ—Ç—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–ü–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–ú–∏—Ñ–æ–ª–æ–≥–∏—è">–ú–∏—Ñ–æ–ª–æ–≥–∏—è</option>
                    <option value="–§–æ–ª—å–∫–ª–æ—Ä">–§–æ–ª—å–∫–ª–æ—Ä</option>
                    <option value="–°–∫–∞–∑–∫–∏">–°–∫–∞–∑–∫–∏</option>
                    <option value="–ë–∞—Å–Ω–∏">–ë–∞—Å–Ω–∏</option>
                </optgroup>
                <optgroup label="–î—Ä—É–≥–æ–µ">
                    <option value="–†–µ–ª–∏–≥–∏—è">–†–µ–ª–∏–≥–∏—è</option>
                    <option value="–≠–∑–æ—Ç–µ—Ä–∏–∫–∞">–≠–∑–æ—Ç–µ—Ä–∏–∫–∞</option>
                    <option value="–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞">–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</option>
                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                </optgroup>
            </select>
            <button class="clear-filters" onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </div>
        <div class="stats" id="stats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="books-container">
        <div class="books-grid" id="booksGrid">
            <div class="no-books">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥...</div>
        </div>
    </div>
    
    <script>
        let allBooks = [];
        let currentBackground = null;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ñ–æ–Ω–∞
        async function loadSettings() {
            try {
                const res = await fetch('/api/settings');
                const data = await res.json();
                if (data.settings && data.settings.background) {
                    currentBackground = data.settings.background;
                    document.body.style.backgroundImage = `url(${currentBackground})`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–Ω–∏–≥
        async function loadBooks(searchQuery = '') {
            try {
                const url = searchQuery 
                    ? `/api/books?search=${encodeURIComponent(searchQuery)}`
                    : '/api/books';
                    
                const res = await fetch(url);
                const books = await res.json();
                
                if (!searchQuery) {
                    allBooks = books;
                }
                
                displayBooks(books);
                updateStats(books.length, searchQuery);
                return Promise.resolve();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥:', error);
                document.getElementById('booksGrid').innerHTML = 
                    '<div class="no-books">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥</div>';
                return Promise.reject(error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–∏–≥
        function displayBooks(books) {
            const grid = document.getElementById('booksGrid');
            
            if (books.length === 0) {
                grid.innerHTML = '<div class="no-books">–ö–Ω–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            grid.innerHTML = '';
            
            books.forEach(book => {
                const card = document.createElement('div');
                card.className = 'book-card';
                const bookId = String(book.id || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                const hasFile = book.book_file ? true : false;
                card.innerHTML = `
                    ${book.cover && book.cover.trim() !== '' ? `
                    <img src="${book.cover}" 
                         alt="${book.title}" 
                         onerror="this.onerror=null; this.style.display='none'; const placeholder=this.nextElementSibling; if(placeholder) placeholder.style.display='flex';" 
                         onload="const placeholder=this.nextElementSibling; if(placeholder) placeholder.style.display='none'; this.style.display='block';"
                         style="width: 100%; height: 200px; object-fit: cover; border-radius: 5px; margin-bottom: 15px; display: block;"
                         crossorigin="anonymous">
                    <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 5px; margin-bottom: 15px; display: none; align-items: center; justify-content: center; color: white; font-size: 48px;">üìö</div>
                    ` : '<div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 5px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">üìö</div>'}
                    <h3>${book.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
                    <div class="author"><b>–ê–≤—Ç–æ—Ä:</b> ${book.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}</div>
                    ${book.genre ? `<span class="genre">${book.genre}</span>` : ''}
                    ${book.description ? `<div class="description">${book.description}</div>` : ''}
                    ${hasFile ? `<button class="read-btn" onclick="downloadBook('${bookId}')" style="width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px;">üìñ –ß–∏—Ç–∞—Ç—å</button>` : ''}
                `;
                grid.appendChild(card);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats(count, searchQuery) {
            const statsEl = document.getElementById('stats');
            if (searchQuery) {
                statsEl.textContent = `–ù–∞–π–¥–µ–Ω–æ –∫–Ω–∏–≥: ${count}`;
            } else {
                statsEl.textContent = `–í—Å–µ–≥–æ –∫–Ω–∏–≥ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ: ${count}`;
            }
        }
        
        // –ü–æ–∏—Å–∫ –∫–Ω–∏–≥
        let searchTimeout;
        function searchBooks(query = null) {
            clearTimeout(searchTimeout);
            
            const searchInput = document.getElementById('searchInput');
            const searchQuery = query !== null ? query : searchInput.value.trim();
            
            if (searchQuery) {
                saveSearchHistory(searchQuery);
            }
            
            searchTimeout = setTimeout(() => {
                applyFilters();
            }, 300);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è/—á—Ç–µ–Ω–∏—è –∫–Ω–∏–≥–∏
        async function downloadBook(bookId) {
            try {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–µ–Ω–∏—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
                window.open(`/read?id=${encodeURIComponent(bookId)}`, '_blank');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–Ω–∏–≥–∏:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–Ω–∏–≥–∏');
            }
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const searchInput = document.getElementById('searchInput');
            const searchQuery = searchInput.value.trim().toLowerCase();
            const filterAuthor = document.getElementById('filterAuthor').value;
            const filterGenre = document.getElementById('filterGenre').value;
            
            let filtered = allBooks.filter(book => {
                const matchesSearch = !searchQuery || 
                    (book.title && book.title.toLowerCase().includes(searchQuery)) ||
                    (book.author && book.author.toLowerCase().includes(searchQuery)) ||
                    (book.genre && book.genre.toLowerCase().includes(searchQuery)) ||
                    (book.description && book.description.toLowerCase().includes(searchQuery));
                
                const matchesAuthor = !filterAuthor || (book.author === filterAuthor);
                const matchesGenre = !filterGenre || (book.genre === filterGenre);
                
                return matchesSearch && matchesAuthor && matchesGenre;
            });
            
            displayBooks(filtered);
            updateStats(filtered.length, searchQuery);
        }
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterAuthor').value = '';
            document.getElementById('filterGenre').value = '';
            applyFilters();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
        function handleSearchInput() {
            searchBooks();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
        function showSearchHistory() {
            const history = document.getElementById('searchHistory');
            const saved = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            if (saved.length > 0) {
                history.style.display = 'block';
            }
        }
        
        // –°–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
        function hideSearchHistory() {
            document.getElementById('searchHistory').style.display = 'none';
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
        function saveSearchHistory(query) {
            if (!query) return;
            let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            history = history.filter(h => h !== query);
            history.unshift(query);
            history = history.slice(0, 10);
            localStorage.setItem('searchHistory', JSON.stringify(history));
            renderSearchHistory();
        }
        
        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
        function renderSearchHistory() {
            const history = document.getElementById('searchHistory');
            const saved = JSON.parse(localStorage.getItem('searchHistory') || '[]');
            history.innerHTML = '';
            
            saved.forEach(query => {
                const item = document.createElement('div');
                item.className = 'search-history-item';
                item.textContent = query;
                item.onclick = () => {
                    document.getElementById('searchInput').value = query;
                    searchBooks(query);
                    hideSearchHistory();
                };
                history.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∞–≤—Ç–æ—Ä–æ–≤ –∏ –∂–∞–Ω—Ä–æ–≤
        function updateFilters() {
            const authors = [...new Set(allBooks.map(b => b.author).filter(Boolean))].sort();
            const genres = [...new Set(allBooks.map(b => b.genre).filter(Boolean))].sort();
            
            const authorSelect = document.getElementById('filterAuthor');
            const genreSelect = document.getElementById('filterGenre');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const currentAuthor = authorSelect.value;
            const currentGenre = genreSelect.value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤
            authorSelect.innerHTML = '<option value="">–í—Å–µ –∞–≤—Ç–æ—Ä—ã</option>';
            authors.forEach(author => {
                const option = document.createElement('option');
                option.value = author;
                option.textContent = author;
                if (author === currentAuthor) option.selected = true;
                authorSelect.appendChild(option);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ (—Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑ –∫–Ω–∏–≥, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
            const genreOptions = genreSelect.querySelectorAll('option[value]');
            genreOptions.forEach(opt => {
                if (opt.value && !genres.includes(opt.value)) {
                    opt.style.display = 'none';
                } else if (opt.value) {
                    opt.style.display = 'block';
                }
            });
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–∫–æ–≤—ã–º –º–µ–Ω—é
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSidebar();
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            loadSettings();
            loadBooks().then(() => {
                updateFilters();
            });
            renderSearchHistory();
        };
    </script>
</body>
</html>

