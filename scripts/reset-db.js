/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω—É–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
 * –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–µ—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü!
 * –ó–∞–ø—É—Å–∫: node scripts/reset-db.js
 */

import { getSql } from '../lib/db-connection.js';
import { checkDatabaseConfig } from '../lib/db-pg.js';

async function resetDatabase() {
  console.log('‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!');
  console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω—É–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
  
  if (!checkDatabaseConfig()) {
    console.error('‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
    process.exit(1);
  }
  
  try {
    const sql = await getSql();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    await sql`SELECT 1`;
    console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü (–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π)
    console.log('üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü...');
    
    // –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —Å–Ω–∞—á–∞–ª–∞
    await sql`DELETE FROM messages`;
    console.log('   ‚úì –°–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã');
    
    await sql`DELETE FROM favorites`;
    console.log('   ‚úì –ò–∑–±—Ä–∞–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–æ');
    
    await sql`DELETE FROM chat_nicknames`;
    console.log('   ‚úì –ù–∏–∫–Ω–µ–π–º—ã —á–∞—Ç–æ–≤ —É–¥–∞–ª–µ–Ω—ã');
    
    await sql`DELETE FROM user_privacy_settings`;
    console.log('   ‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω—ã');
    
    await sql`DELETE FROM bookmarks`;
    console.log('   ‚úì –ó–∞–∫–ª–∞–¥–∫–∏ —É–¥–∞–ª–µ–Ω—ã');
    
    await sql`DELETE FROM logs`;
    console.log('   ‚úì –õ–æ–≥–∏ —É–¥–∞–ª–µ–Ω—ã');
    
    await sql`DELETE FROM books`;
    console.log('   ‚úì –ö–Ω–∏–≥–∏ —É–¥–∞–ª–µ–Ω—ã');
    
    await sql`DELETE FROM users`;
    console.log('   ‚úì –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–¥–∞–ª–µ–Ω—ã');
    
    console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –æ–±–Ω—É–ª–µ–Ω–∞!');
    console.log('üí° –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–Ω–æ–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥–∏');
    
    process.exit(0);
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω—É–ª–µ–Ω–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:', error);
    process.exit(1);
  }
}

resetDatabase();

